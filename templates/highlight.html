{% extends "layout.html" %}

{% block head %}
{% endblock %}

{% block header %}
{% endblock %}

{% block nav %}
{% endblock %}

{% block section %}
    <div id="code" class="row">
        <div class="col-md-6">
            <p>origin</p>
            <div style="height: 400px">
                <editor editor-id="editorA" :content="contentA" v-on:change-content="changeContentA"></editor>
            </div>
        </div>

        <div class="col-md-6">
            <p>modification</p>
            <div style="height: 400px">
                <editor editor-id="editorB" :content="contentB" v-on:change-content="changeContentB"></editor>
            </div>
        </div>
    </div>
{% endblock %}

{% block footer %}
{% endblock %}

{% block script %}
<script src="../static/js/ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    Vue.component('Editor', {
        template: '<div :id="editorId" style="width: 100%; height: 100%;"></div>',
        props: ['editorId', 'content', 'lang', 'theme'],
        data () {
            return {
            editor: Object,
            beforeContent: ''
            }
        },
        watch: {
            'content' (value) {
                if (this.beforeContent !== value) {
                this.editor.setValue(value, 1)
            }
            }
        },
        mounted () {
            const lang = this.lang || 'javascript'
            const theme = this.theme || 'monokai'
        
            this.editor = window.ace.edit(this.editorId)
            this.editor.setValue(this.content, 1)
            
            this.editor.getSession().setMode(`ace/mode/${lang}`)
            this.editor.setTheme(`ace/theme/${theme}`)

            this.editor.on('change', () => {
                this.beforeContent = this.editor.getValue()
            this.$emit('change-content', this.editor.getValue())
            })
        }
        })


        const code = new Vue({
            el: "#code",
        data () {
            return {
            contentA: 'default content for Editor A',
            contentB: 'default content for Editor B'
            }
        },
        methods: {
            reset () {
                this.contentA = 'reset content for Editor A'
                this.contentB = 'reset content for Editor B'
            },
            changeContentA (val) {
                if (this.contentA !== val) {
                    this.contentA = val
                }
            },
            changeContentB (val) {
                if (this.contentB !== val) {
                    this.contentB = val
                }
            }
        }
    })
</script>
{% endblock %}